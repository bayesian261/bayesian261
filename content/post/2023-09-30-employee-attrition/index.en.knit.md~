---
title: Employee Attrition
author: Bongani Ncube
date: '2023-09-30'
slug: []
categories:
  - classification
  - datascience
  - xgboost
  - predictivemodeling
tags: []
subtitle: ''
summary: ''
authors: []
lastmod: '2023-09-30T16:31:06+02:00'
featured: no
image:
  caption: ''
  focal_point: ''
  preview_only: no
projects: []
---

# The Main Problem

**Use Cases: Employee Retention Analysis**

The objective is to understand what factors contributed most to employee attrition and to create a model that can predict if a certain employee will leave the company or not. The goal also includes helping in formulating different retention strategies on targeted employees. Overall, the implementation of this model will allow management to create better decision-making actions.

## data setup

```r
library(tidyverse)
```

```
## -- Attaching core tidyverse packages ------------------------ tidyverse 2.0.0 --
## v dplyr     1.1.3     v readr     2.1.4
## v forcats   1.0.0     v stringr   1.5.0
## v ggplot2   3.4.3     v tibble    3.2.1
## v lubridate 1.9.2     v tidyr     1.3.0
## v purrr     1.0.2     
## -- Conflicts ------------------------------------------ tidyverse_conflicts() --
## x dplyr::filter() masks stats::filter()
## x dplyr::lag()    masks stats::lag()
## i Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors
```

```r
library(scales)
```

```
## 
## Attaching package: 'scales'
## 
## The following object is masked from 'package:purrr':
## 
##     discard
## 
## The following object is masked from 'package:readr':
## 
##     col_factor
```

```r
library(glue)
library(ggplot2)

source(file = "R/helper.R")
```


```r
data_attrition <- read_csv("data-attrition.csv") 
```

```
## Rows: 1470 Columns: 35
## -- Column specification --------------------------------------------------------
## Delimiter: ","
## chr  (9): attrition, business_travel, department, education_field, gender, j...
## dbl (26): age, daily_rate, distance_from_home, education, employee_count, em...
## 
## i Use `spec()` to retrieve the full column specification for this data.
## i Specify the column types or set `show_col_types = FALSE` to quiet this message.
```

```r
head(data_attrition)
```

```
## # A tibble: 6 x 35
##   attrition   age business_travel   daily_rate department     distance_from_home
##   <chr>     <dbl> <chr>                  <dbl> <chr>                       <dbl>
## 1 yes          41 travel_rarely           1102 sales                           1
## 2 no           49 travel_frequently        279 research_deve~                  8
## 3 yes          37 travel_rarely           1373 research_deve~                  2
## 4 no           33 travel_frequently       1392 research_deve~                  3
## 5 no           27 travel_rarely            591 research_deve~                  2
## 6 no           32 travel_frequently       1005 research_deve~                  2
## # i 29 more variables: education <dbl>, education_field <chr>,
## #   employee_count <dbl>, employee_number <dbl>,
## #   environment_satisfaction <dbl>, gender <chr>, hourly_rate <dbl>,
## #   job_involvement <dbl>, job_level <dbl>, job_role <chr>,
## #   job_satisfaction <dbl>, marital_status <chr>, monthly_income <dbl>,
## #   monthly_rate <dbl>, num_companies_worked <dbl>, over_18 <chr>,
## #   over_time <chr>, percent_salary_hike <dbl>, performance_rating <dbl>, ...
```

## data exploration

```r
skimr::skim(data_attrition)
```


Table: (\#tab:unnamed-chunk-3)Data summary

|                         |               |
|:------------------------|:--------------|
|Name                     |data_attrition |
|Number of rows           |1470           |
|Number of columns        |35             |
|_______________________  |               |
|Column type frequency:   |               |
|character                |9              |
|numeric                  |26             |
|________________________ |               |
|Group variables          |None           |


**Variable type: character**

|skim_variable   | n_missing| complete_rate| min| max| empty| n_unique| whitespace|
|:---------------|---------:|-------------:|---:|---:|-----:|--------:|----------:|
|attrition       |         0|             1|   2|   3|     0|        2|          0|
|business_travel |         0|             1|  10|  17|     0|        3|          0|
|department      |         0|             1|   5|  20|     0|        3|          0|
|education_field |         0|             1|   5|  16|     0|        6|          0|
|gender          |         0|             1|   4|   6|     0|        2|          0|
|job_role        |         0|             1|   7|  25|     0|        9|          0|
|marital_status  |         0|             1|   6|   8|     0|        3|          0|
|over_18         |         0|             1|   1|   1|     0|        1|          0|
|over_time       |         0|             1|   2|   3|     0|        2|          0|


**Variable type: numeric**

|skim_variable              | n_missing| complete_rate|     mean|      sd|   p0|     p25|     p50|      p75|  p100|hist                                     |
|:--------------------------|---------:|-------------:|--------:|-------:|----:|-------:|-------:|--------:|-----:|:----------------------------------------|
|age                        |         0|             1|    36.92|    9.14|   18|   30.00|    36.0|    43.00|    60|▂▇▇▃▂ |
|daily_rate                 |         0|             1|   802.49|  403.51|  102|  465.00|   802.0|  1157.00|  1499|▇▇▇▇▇ |
|distance_from_home         |         0|             1|     9.19|    8.11|    1|    2.00|     7.0|    14.00|    29|▇▅▂▂▂ |
|education                  |         0|             1|     2.91|    1.02|    1|    2.00|     3.0|     4.00|     5|▂▃▇▆▁ |
|employee_count             |         0|             1|     1.00|    0.00|    1|    1.00|     1.0|     1.00|     1|▁▁▇▁▁ |
|employee_number            |         0|             1|  1024.87|  602.02|    1|  491.25|  1020.5|  1555.75|  2068|▇▇▇▇▇ |
|environment_satisfaction   |         0|             1|     2.72|    1.09|    1|    2.00|     3.0|     4.00|     4|▅▅▁▇▇ |
|hourly_rate                |         0|             1|    65.89|   20.33|   30|   48.00|    66.0|    83.75|   100|▇▇▇▇▇ |
|job_involvement            |         0|             1|     2.73|    0.71|    1|    2.00|     3.0|     3.00|     4|▁▃▁▇▁ |
|job_level                  |         0|             1|     2.06|    1.11|    1|    1.00|     2.0|     3.00|     5|▇▇▃▂▁ |
|job_satisfaction           |         0|             1|     2.73|    1.10|    1|    2.00|     3.0|     4.00|     4|▅▅▁▇▇ |
|monthly_income             |         0|             1|  6502.93| 4707.96| 1009| 2911.00|  4919.0|  8379.00| 19999|▇▅▂▁▂ |
|monthly_rate               |         0|             1| 14313.10| 7117.79| 2094| 8047.00| 14235.5| 20461.50| 26999|▇▇▇▇▇ |
|num_companies_worked       |         0|             1|     2.69|    2.50|    0|    1.00|     2.0|     4.00|     9|▇▃▂▂▁ |
|percent_salary_hike        |         0|             1|    15.21|    3.66|   11|   12.00|    14.0|    18.00|    25|▇▅▃▂▁ |
|performance_rating         |         0|             1|     3.15|    0.36|    3|    3.00|     3.0|     3.00|     4|▇▁▁▁▂ |
|relationship_satisfaction  |         0|             1|     2.71|    1.08|    1|    2.00|     3.0|     4.00|     4|▅▅▁▇▇ |
|standard_hours             |         0|             1|    80.00|    0.00|   80|   80.00|    80.0|    80.00|    80|▁▁▇▁▁ |
|stock_option_level         |         0|             1|     0.79|    0.85|    0|    0.00|     1.0|     1.00|     3|▇▇▁▂▁ |
|total_working_years        |         0|             1|    11.28|    7.78|    0|    6.00|    10.0|    15.00|    40|▇▇▂▁▁ |
|training_times_last_year   |         0|             1|     2.80|    1.29|    0|    2.00|     3.0|     3.00|     6|▂▇▇▂▃ |
|work_life_balance          |         0|             1|     2.76|    0.71|    1|    2.00|     3.0|     3.00|     4|▁▃▁▇▂ |
|years_at_company           |         0|             1|     7.01|    6.13|    0|    3.00|     5.0|     9.00|    40|▇▂▁▁▁ |
|years_in_current_role      |         0|             1|     4.23|    3.62|    0|    2.00|     3.0|     7.00|    18|▇▃▂▁▁ |
|years_since_last_promotion |         0|             1|     2.19|    3.22|    0|    0.00|     1.0|     3.00|    15|▇▁▁▁▁ |
|years_with_curr_manager    |         0|             1|     4.12|    3.57|    0|    2.00|     3.0|     7.00|    17|▇▂▅▁▁ |

## check for missing values

```r
colSums(is.na(data_attrition))
```

```
##                  attrition                        age 
##                          0                          0 
##            business_travel                 daily_rate 
##                          0                          0 
##                 department         distance_from_home 
##                          0                          0 
##                  education            education_field 
##                          0                          0 
##             employee_count            employee_number 
##                          0                          0 
##   environment_satisfaction                     gender 
##                          0                          0 
##                hourly_rate            job_involvement 
##                          0                          0 
##                  job_level                   job_role 
##                          0                          0 
##           job_satisfaction             marital_status 
##                          0                          0 
##             monthly_income               monthly_rate 
##                          0                          0 
##       num_companies_worked                    over_18 
##                          0                          0 
##                  over_time        percent_salary_hike 
##                          0                          0 
##         performance_rating  relationship_satisfaction 
##                          0                          0 
##             standard_hours         stock_option_level 
##                          0                          0 
##        total_working_years   training_times_last_year 
##                          0                          0 
##          work_life_balance           years_at_company 
##                          0                          0 
##      years_in_current_role years_since_last_promotion 
##                          0                          0 
##    years_with_curr_manager 
##                          0
```
> there are no missing values

## check for data types

```r
map_chr(data_attrition,class)
```

```
##                  attrition                        age 
##                "character"                  "numeric" 
##            business_travel                 daily_rate 
##                "character"                  "numeric" 
##                 department         distance_from_home 
##                "character"                  "numeric" 
##                  education            education_field 
##                  "numeric"                "character" 
##             employee_count            employee_number 
##                  "numeric"                  "numeric" 
##   environment_satisfaction                     gender 
##                  "numeric"                "character" 
##                hourly_rate            job_involvement 
##                  "numeric"                  "numeric" 
##                  job_level                   job_role 
##                  "numeric"                "character" 
##           job_satisfaction             marital_status 
##                  "numeric"                "character" 
##             monthly_income               monthly_rate 
##                  "numeric"                  "numeric" 
##       num_companies_worked                    over_18 
##                  "numeric"                "character" 
##                  over_time        percent_salary_hike 
##                "character"                  "numeric" 
##         performance_rating  relationship_satisfaction 
##                  "numeric"                  "numeric" 
##             standard_hours         stock_option_level 
##                  "numeric"                  "numeric" 
##        total_working_years   training_times_last_year 
##                  "numeric"                  "numeric" 
##          work_life_balance           years_at_company 
##                  "numeric"                  "numeric" 
##      years_in_current_role years_since_last_promotion 
##                  "numeric"                  "numeric" 
##    years_with_curr_manager 
##                  "numeric"
```
## data wrangling
+ we will change characters to factors


```r
data_attrition<-data_attrition |> 
  mutate_if(is.character,as.factor)
```

## 

```r
attrition_factors <- data_attrition |>
  select(gender,attrition) |> 
  gather() |> 
  group_by(key,value) |>
  summarize(count = n()) |> 
  mutate(prop = count/sum(count)) |>
  ungroup() 
```

```
## Warning: attributes are not identical across measure variables; they will be
## dropped
```

```
## `summarise()` has grouped output by 'key'. You can override using the `.groups`
## argument.
```

```r
plot<-attrition_factors |>
  ggplot(aes(fill=key, y=prop, x=value)) + 
  geom_col(color="black",width = 0.5)+ 
  facet_wrap(~key,scales="free") +
  theme(legend.position="bottom") + 
  geom_label(aes(label=scales::percent(prop)), color="white") + 
  labs(
    title = "Categorical features",
    subtitle = "Frequency",
    y = "proportion(%)", 
    x = "",
    fill="status") + 
  scale_y_continuous(labels = scales::percent)+
  ggthemes::scale_fill_tableau()+
 ggthemes::theme_pander() +
  theme(legend.position = 'none')+
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) 
plot
```

<img src="index.en_files/figure-html/unnamed-chunk-7-1.png" width="672" />





```r
# aggregation
data_agg <- data_attrition %>% 
  group_by(department, attrition) %>% 
  summarise(Freq = n()) %>% 
  ungroup()
```

```
## `summarise()` has grouped output by 'department'. You can override using the
## `.groups` argument.
```

```r
# print some examples
head(data_agg)
```

```
## # A tibble: 6 x 3
##   department           attrition  Freq
##   <fct>                <fct>     <int>
## 1 human_resources      no           51
## 2 human_resources      yes          12
## 3 research_development no          828
## 4 research_development yes         133
## 5 sales                no          354
## 6 sales                yes          92
```
  

```r
# prepare visualization data
data_viz <- data_agg %>% 
  filter(attrition == "yes")

# print some example
data_viz
```

```
## # A tibble: 3 x 3
##   department           attrition  Freq
##   <fct>                <fct>     <int>
## 1 human_resources      yes          12
## 2 research_development yes         133
## 3 sales                yes          92
```

# Visualize Data

## Categorical Ranking

For a starter, let’s try to see the ranking of `education field` in terms of number of employee.











































